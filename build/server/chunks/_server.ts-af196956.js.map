{"version":3,"file":"_server.ts-af196956.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/reports/reservations/_server.ts.js"],"sourcesContent":["import { g as getXataUserDocWithFirebaseToken } from \"../../../../../chunks/firestore.js\";\nimport { g as getXataClient } from \"../../../../../chunks/xata-old.js\";\nimport { j as json } from \"../../../../../chunks/index.js\";\nimport dayjs from \"dayjs\";\nconst xata = getXataClient();\nasync function GET({ request, url }) {\n  try {\n    const xataUser = await getXataUserDocWithFirebaseToken(request.headers);\n    if (!xataUser || xataUser.status !== \"active\")\n      throw new Error(\"User not allowed to access this resource\");\n    const queryParams = url.searchParams;\n    const startDate = queryParams.get(\"startDate\");\n    const endDate = queryParams.get(\"endDate\");\n    const dateArray = [];\n    let currentDate = dayjs(startDate);\n    while (currentDate.isBefore(dayjs(endDate).add(1, \"day\"))) {\n      dateArray.push(currentDate.format(\"YYYY-MM-DD\"));\n      currentDate = currentDate.add(1, \"day\");\n    }\n    const reservations = await xata.db.Reservations.filter({\n      date: {\n        $any: dateArray\n      },\n      status: {\n        $any: [\"confirmed\", \"pending\"]\n      }\n    }).select([\"date\", \"category\", \"owTime\", \"status\", \"resType\", \"numStudents\"]).getAll();\n    const summary = {};\n    for (const date of dateArray) {\n      summary[date] = {\n        pool: 0,\n        openwater: {\n          AM: 0,\n          PM: 0,\n          total: 0\n        },\n        classroom: 0\n      };\n    }\n    for (const reservation of reservations) {\n      const date = reservation.date;\n      const category = reservation.category;\n      const owTime = reservation.owTime;\n      if (!date)\n        continue;\n      const day = summary[date];\n      if (!day)\n        continue;\n      const count = reservation.resType === \"course\" ? (reservation.numStudents || 0) + 1 : 1;\n      if (category === \"pool\") {\n        day.pool += count;\n      } else if (category === \"classroom\") {\n        day.classroom += count;\n      } else if (category === \"openwater\") {\n        if (owTime === \"AM\") {\n          day.openwater.AM += count;\n        } else if (owTime === \"PM\") {\n          day.openwater.PM += count;\n        }\n        day.openwater.total += count;\n      }\n    }\n    return json({ status: \"success\", summary });\n  } catch (error) {\n    return json({ status: \"error\", error });\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}