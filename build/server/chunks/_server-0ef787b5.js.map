{"version":3,"file":"_server-0ef787b5.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/lockBuoyAssignments/_server.js"],"sourcesContent":["import { g as getXataClient } from \"../../../../chunks/xata-old.js\";\nimport { a as assignRsvsToBuoys } from \"../../../../chunks/assignRsvsToBuoys.js\";\nimport \"../../../../chunks/datetimeUtils.js\";\nimport \"../../../../chunks/settings.js\";\nimport { j as json } from \"../../../../chunks/index.js\";\nconst xata = getXataClient();\nasync function POST({ request }) {\n  try {\n    let { lock, date } = await request.json();\n    let rsvs = await xata.db.Reservations.filter({\n      date,\n      category: \"openwater\",\n      status: { $any: [\"pending\", \"confirmed\"] }\n    }).getAll();\n    rsvs = rsvs.map((rsv) => {\n      return { ...rsv };\n    });\n    const updates = [];\n    if (lock) {\n      let buoys = await xata.db.Buoys.getAll();\n      for (let owTime of [\"AM\", \"PM\"]) {\n        const { assignments } = assignRsvsToBuoys(\n          buoys,\n          rsvs.filter((rsv) => rsv.owTime === owTime)\n        );\n        for (const buoy of buoys) {\n          let toAsn = assignments[buoy.name];\n          if (toAsn != void 0) {\n            updates.push(\n              ...toAsn.map((rsv) => {\n                return { id: rsv.id, buoy: buoy.name };\n              })\n            );\n          }\n        }\n      }\n    } else {\n      rsvs.forEach((rsv) => updates.push({ id: rsv.id, buoy: \"auto\" }));\n    }\n    let reservations = await xata.db.Reservations.update(updates);\n    return json({ status: \"success\", reservations });\n  } catch (error) {\n    console.error(\"error lockBuoyAssignments\", error);\n    return json({ status: \"error\", error });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAKA,MAAM,IAAI,GAAG,aAAa,EAAE,CAAC;AAC7B,eAAe,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE;AACjC,EAAE,IAAI;AACN,IAAI,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AAC9C,IAAI,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC;AACjD,MAAM,IAAI;AACV,MAAM,QAAQ,EAAE,WAAW;AAC3B,MAAM,MAAM,EAAE,EAAE,IAAI,EAAE,CAAC,SAAS,EAAE,WAAW,CAAC,EAAE;AAChD,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC;AAChB,IAAI,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK;AAC7B,MAAM,OAAO,EAAE,GAAG,GAAG,EAAE,CAAC;AACxB,KAAK,CAAC,CAAC;AACP,IAAI,MAAM,OAAO,GAAG,EAAE,CAAC;AACvB,IAAI,IAAI,IAAI,EAAE;AACd,MAAM,IAAI,KAAK,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;AAC/C,MAAM,KAAK,IAAI,MAAM,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE;AACvC,QAAQ,MAAM,EAAE,WAAW,EAAE,GAAG,iBAAiB;AACjD,UAAU,KAAK;AACf,UAAU,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,MAAM,KAAK,MAAM,CAAC;AACrD,SAAS,CAAC;AACV,QAAQ,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;AAClC,UAAU,IAAI,KAAK,GAAG,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC7C,UAAU,IAAI,KAAK,IAAI,KAAK,CAAC,EAAE;AAC/B,YAAY,OAAO,CAAC,IAAI;AACxB,cAAc,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK;AACpC,gBAAgB,OAAO,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC;AACvD,eAAe,CAAC;AAChB,aAAa,CAAC;AACd,WAAW;AACX,SAAS;AACT,OAAO;AACP,KAAK,MAAM;AACX,MAAM,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;AACxE,KAAK;AACL,IAAI,IAAI,YAAY,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AAClE,IAAI,OAAO,IAAI,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,CAAC,CAAC;AACrD,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,2BAA2B,EAAE,KAAK,CAAC,CAAC;AACtD,IAAI,OAAO,IAAI,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;AAC5C,GAAG;AACH;;;;"}