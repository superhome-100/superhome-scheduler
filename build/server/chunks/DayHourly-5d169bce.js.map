{"version":3,"file":"DayHourly-5d169bce.js","sources":["../../../.svelte-kit/adapter-node/chunks/DayHourly.js"],"sourcesContent":["import { c as create_ssr_component, h as subscribe, p as getContext, i as each, e as escape, v as validate_component } from \"./index3.js\";\nimport { s as startTimes, f as endTimes } from \"./reservations.js\";\nimport { b as users, v as viewMode, f as getReservationsByDate } from \"./stores2.js\";\nimport { b as datetimeToLocalDateStr, t as timeStrToMin } from \"./datetimeUtils.js\";\nimport \"svelte-gestures\";\nimport \"devalue\";\nimport { S as Settings, R as ReservationCategory } from \"./settings.js\";\nimport { g as getDaySchedule, b as badgeColor } from \"./ReservationDialog.js\";\nimport \"./firebase.js\";\nimport \"firebase/firestore\";\nimport \"dayjs\";\nimport \"./ExclamationCircle.js\";\nimport { L as LoadingBar } from \"./LoadingBar.js\";\nconst rowHeight = 3;\nconst blkMgn = 0.25;\nconst DayHourly = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  let assignment;\n  let slotDiv;\n  let innerWidth;\n  let slotWidthPx;\n  let $users, $$unsubscribe_users;\n  let $$unsubscribe_viewMode;\n  $$unsubscribe_users = subscribe(users, (value) => $users = value);\n  $$unsubscribe_viewMode = subscribe(viewMode, (value) => value);\n  let { resInfo } = $$props;\n  let { category } = $$props;\n  let { date } = $$props;\n  let { refreshTs = Date.now() } = $$props;\n  let reservations = [];\n  let isLoading = false;\n  getContext(\"simple-modal\");\n  const slotsPerHr = (date2, category2) => {\n    let st = startTimes(Settings, date2, category2);\n    let et = endTimes(Settings, date2, category2);\n    let beg = st[0];\n    let end = et[et.length - 1];\n    let totalMin = timeStrToMin(end) - timeStrToMin(beg);\n    let sph = 60 / (totalMin / st.length);\n    return sph;\n  };\n  const displayTimes = (date2, category2) => {\n    let dateStr = datetimeToLocalDateStr(date2);\n    let st = startTimes(Settings, dateStr, category2);\n    let et = endTimes(Settings, dateStr, category2);\n    let hrs = [];\n    for (let i = 0; i < st.length; i++) {\n      if (i % slotDiv == 0) {\n        hrs.push(st[i]);\n      }\n    }\n    hrs.push(et[et.length - 1]);\n    return hrs;\n  };\n  const formatTag = (rsvs, nSlots, width, slotWidthPx2) => {\n    let tag = \"\";\n    if (rsvs[0].resType === \"course\") {\n      let nickname = $users[rsvs[0].user.id].nickname;\n      tag = nickname + \" +\" + rsvs[0].numStudents;\n    } else {\n      for (let i = 0; i < rsvs.length; i++) {\n        let nickname = $users[rsvs[i].user.id].nickname;\n        tag += nickname;\n        if (i < rsvs.length - 1) {\n          tag += \" and \";\n        }\n      }\n    }\n    let lines = [];\n    let start = 0;\n    for (let i = 0; i < nSlots; i++) {\n      let pxPerChar = (i == 0 ? 12 : 11) - 2 * width;\n      let maxChar = Math.floor(width * slotWidthPx2 / pxPerChar);\n      if (start < tag.length) {\n        let nChar = Math.min(tag.length - start, maxChar);\n        lines.push(tag.substr(start, nChar));\n        start += nChar;\n      }\n    }\n    return lines;\n  };\n  const spaceStyling = (styleType) => {\n    if (styleType == \"single\") {\n      return \"mx-0.5 rounded-lg\";\n    } else if (styleType == \"start\") {\n      return \"ms-0.5 rounded-s-xl\";\n    } else if (styleType == \"end\") {\n      return \"me-0.5 rounded-e-xl\";\n    } else {\n      return \"rounded-none\";\n    }\n  };\n  const loadReservations = async () => {\n    isLoading = true;\n    const res = await getReservationsByDate(date, category === \"pool\" ? ReservationCategory.pool : ReservationCategory.classroom);\n    if (res.status === \"success\") {\n      reservations = res.reservations || [];\n    }\n    isLoading = false;\n  };\n  if ($$props.resInfo === void 0 && $$bindings.resInfo && resInfo !== void 0)\n    $$bindings.resInfo(resInfo);\n  if ($$props.category === void 0 && $$bindings.category && category !== void 0)\n    $$bindings.category(category);\n  if ($$props.date === void 0 && $$bindings.date && date !== void 0)\n    $$bindings.date(date);\n  if ($$props.refreshTs === void 0 && $$bindings.refreshTs && refreshTs !== void 0)\n    $$bindings.refreshTs(refreshTs);\n  assignment = getDaySchedule(reservations, date, category);\n  slotDiv = slotsPerHr(datetimeToLocalDateStr(date), category);\n  innerWidth = 0;\n  slotWidthPx = parseInt(innerWidth * 88 / resInfo.resources.length / 100);\n  {\n    {\n      (date || refreshTs) && loadReservations();\n    }\n  }\n  $$unsubscribe_users();\n  $$unsubscribe_viewMode();\n  return `\n${isLoading ? `${validate_component(LoadingBar, \"LoadingBar\").$$render($$result, {}, {}, {})}` : ``}\n${Settings.getOpenForBusiness(datetimeToLocalDateStr(date)) === false ? `<div class=\"font-semibold text-3xl text-center\">Closed</div>` : `${assignment.status === \"error\" ? `<div class=\"font-semibold text-red-600 text-xl text-center\">Error assigning reservations!</div>\n\t\t<div class=\"text-sm text-center mb-4\">Please report this error to the admin</div>` : ``}\n\t<div class=\"row text-xs sm:text-base\"><div class=\"column w-[12%] m-0 text-center\"><div style=\"height: 1lh\"></div>\n\t\t\t${each(displayTimes(date, category), (t) => {\n    return `<div class=\"font-semibold\" style=\"${\"height: \" + escape(rowHeight, true) + \"rem\"}\">${escape(t)}</div>`;\n  })}</div>\n\t\t${each(resInfo.resources, (resource, i) => {\n    return `<div class=\"column text-center\" style=\"${\"width: \" + escape(88 / resInfo.resources.length, true) + \"%\"}\"><div class=\"font-semibold\">${escape(resInfo.name)} ${escape(resource)}</div>\n\t\t\t\t${assignment.schedule[i] ? `<div style=\"height: 0.5rem\"></div>\n\t\t\t\t\t${each(assignment.schedule[i], (blk) => {\n      return `${blk.blkType === \"rsv\" ? `<div class=\"${\"rsv \" + escape(category, true) + \" bg-fixed \" + escape(spaceStyling(blk.styleType), true) + \" mb-1 text-sm cursor-pointer hover:font-semibold\"}\" style=\"${\"height: \" + escape(rowHeight * (blk.nSlots / slotDiv) - blkMgn, true) + \"rem\"}\"><div class=\"block indicator w-full\">${[\"single\", \"end\"].includes(blk.styleType) ? `<span class=\"${\"rsv-indicator \" + escape(badgeColor(blk.data), true)}\"></span>` : ``}\n\t\t\t\t\t\t\t\t\t${[\"single\", \"start\"].includes(blk.styleType) ? `${each(formatTag(blk.data, blk.nSlots, blk.width, slotWidthPx), (line) => {\n        return `<div>${escape(line)}</div>`;\n      })}` : ``}</div>\n\t\t\t\t\t\t\t</div>` : `<div style=\"${\"height: \" + escape(rowHeight * (blk.nSlots / slotDiv), true) + \"rem\"}\"></div>`}`;\n    })}` : ``}\n\t\t\t</div>`;\n  })}</div>`}`;\n});\nexport {\n  DayHourly as D\n};\n"],"names":[],"mappings":"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"}