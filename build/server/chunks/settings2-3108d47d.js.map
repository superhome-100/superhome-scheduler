{"version":3,"file":"settings2-3108d47d.js","sources":["../../../.svelte-kit/adapter-node/chunks/settings2.js"],"sourcesContent":["import { g as getXataClient } from \"./xata-old.js\";\nimport { g as getSettingsManager } from \"./settingsManager.js\";\nconst xata = getXataClient();\nlet settings;\nconst initSettings = async () => {\n  if (!settings) {\n    settings = await getSettings();\n  }\n  return getSettingsManager(settings);\n};\nconst getSettings = async () => {\n  const settingsTbl = await xata.db.Settings.getAll();\n  return parseSettingsTbl(settingsTbl);\n};\nfunction parseSettingsTbl(settingsTbl) {\n  let settings2 = {};\n  let fields = new Set(settingsTbl.map((e) => e.name));\n  let fixTypes = (e) => {\n    let name = e.name;\n    let v = e.value;\n    if ([\"maxChargeableOWPerMonth\", \"refreshIntervalSeconds\", \"reservationLeadTimeDays\"].includes(\n      name\n    )) {\n      v = parseInt(v);\n    }\n    if (name === \"refreshIntervalSeconds\") {\n      name = \"refreshInterval\";\n      v = v * 1e3;\n    }\n    if ([\n      \"cbsAvailable\",\n      \"classroomBookable\",\n      \"openForBusiness\",\n      \"openwaterAmBookable\",\n      \"openwaterPmBookable\",\n      \"poolBookable\"\n    ].includes(name)) {\n      v = v === \"true\";\n    }\n    if ([\"poolLanes\", \"classrooms\", \"boats\", \"captains\"].includes(name)) {\n      v = v.split(\";\");\n    }\n    return {\n      ...e,\n      name,\n      value: v\n    };\n  };\n  fields.forEach((field) => {\n    let entries = settingsTbl.filter((e) => e.name === field).map((e) => fixTypes(e));\n    let def = entries.splice(\n      entries.findIndex((e) => e.startDate === \"default\"),\n      1\n    )[0];\n    if (def.name) {\n      settings2[def.name] = {\n        default: def.value,\n        entries\n      };\n    }\n  });\n  return settings2;\n}\nexport {\n  getSettings as g,\n  initSettings as i\n};\n"],"names":[],"mappings":"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"}