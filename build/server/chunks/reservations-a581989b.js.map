{"version":3,"file":"reservations-a581989b.js","sources":["../../../.svelte-kit/adapter-node/chunks/reservations.js"],"sourcesContent":["import { R as ReservationCategory } from \"./settings.js\";\nimport { P as PanglaoDate, b as datetimeToLocalDateStr, t as timeStrToMin, m as minToTimeStr } from \"./datetimeUtils.js\";\nconst minPoolStart = (stns, date) => timeStrToMin(stns.getMinPoolStartTime(date));\nconst maxPoolEnd = (stns, date) => timeStrToMin(stns.getMaxPoolEndTime(date));\nconst minClassroomStart = (stns, date) => timeStrToMin(stns.getMinClassroomStartTime(date));\nconst maxClassroomEnd = (stns, date) => timeStrToMin(stns.getMaxClassroomEndTime(date));\nconst resCutoff = (stns, date) => timeStrToMin(stns.getReservationCutOffTime(date));\nconst cancelCutoff = (stns, cat, date) => {\n  if ([ReservationCategory.pool, ReservationCategory.classroom].includes(cat)) {\n    return 0;\n  } else {\n    return timeStrToMin(stns.getCancelationCutOffTime(date));\n  }\n};\nconst inc = (stns, date) => timeStrToMin(stns.getReservationIncrement(date));\nconst minuteOfDay = (date) => date.getHours() * 60 + date.getMinutes();\nfunction beforeResCutoff(stns, dateStr, startTime, category) {\n  let now = PanglaoDate();\n  let today = datetimeToLocalDateStr(now);\n  let tomorrow = PanglaoDate();\n  tomorrow.setDate(now.getDate() + 1);\n  let tomStr = datetimeToLocalDateStr(tomorrow);\n  if ([ReservationCategory.pool, ReservationCategory.classroom].includes(category)) {\n    if (dateStr > today) {\n      return true;\n    } else if (dateStr === today) {\n      const timeUntilStart = timeStrToMin(startTime) - minuteOfDay(now);\n      return timeUntilStart > 0;\n    }\n    return false;\n  } else if (dateStr > tomStr) {\n    return true;\n  } else if (dateStr == tomStr && minuteOfDay(now) <= resCutoff(stns, dateStr)) {\n    return true;\n  } else {\n    return false;\n  }\n}\nfunction beforeCancelCutoff(stns, dateStr, startTime, category) {\n  let now = PanglaoDate();\n  let today = datetimeToLocalDateStr(now);\n  if (dateStr > today) {\n    return true;\n  } else {\n    const timeUntilStart = timeStrToMin(startTime) - minuteOfDay(now);\n    if ([ReservationCategory.pool, ReservationCategory.classroom].includes(category)) {\n      return dateStr === today && timeUntilStart > 60;\n    } else {\n      return dateStr === today && timeUntilStart > cancelCutoff(stns, category, dateStr);\n    }\n  }\n}\nconst minStart = (stns, dateStr, cat) => cat === ReservationCategory.pool ? minPoolStart(stns, dateStr) : minClassroomStart(stns, dateStr);\nconst maxEnd = (stns, dateStr, cat) => cat === ReservationCategory.pool ? maxPoolEnd(stns, dateStr) : maxClassroomEnd(stns, dateStr);\nconst nRes = (stns, dateStr, cat) => Math.floor((maxEnd(stns, dateStr, cat) - minStart(stns, dateStr, cat)) / inc(stns, dateStr));\nconst getStartEndTimes = (stns, dateStr, cat) => Array(nRes(stns, dateStr, cat) + 1).fill(void 0).map((v, i) => minToTimeStr(minStart(stns, dateStr, cat) + i * inc(stns, dateStr)));\nconst startTimes = (stns, dateStr, cat) => getStartEndTimes(stns, dateStr, cat).slice(0, -1);\nconst endTimes = (stns, dateStr, cat) => getStartEndTimes(stns, dateStr, cat).slice(1);\nfunction minValidDate(stns, category) {\n  let today = PanglaoDate();\n  let todayStr = datetimeToLocalDateStr(today);\n  let d = PanglaoDate();\n  if ([ReservationCategory.pool, ReservationCategory.classroom].includes(category)) {\n    let sTs = startTimes(stns, todayStr, category);\n    let lastSlot = timeStrToMin(sTs[sTs.length - 1]);\n    if (minuteOfDay(today) < lastSlot) {\n      d.setDate(today.getDate());\n    } else {\n      d.setDate(today.getDate() + 1);\n    }\n  } else if (minuteOfDay(today) < resCutoff(stns, todayStr)) {\n    d.setDate(today.getDate() + 1);\n  } else {\n    d.setDate(today.getDate() + 2);\n  }\n  return d;\n}\nfunction minValidDateStr(stns, category) {\n  let d = minValidDate(stns, category);\n  return datetimeToLocalDateStr(d);\n}\nfunction maxValidDate(stns) {\n  let today = PanglaoDate();\n  let todayStr = datetimeToLocalDateStr(today);\n  let maxDay = PanglaoDate();\n  maxDay.setDate(today.getDate() + stns.getReservationLeadTimeDays(todayStr));\n  return maxDay;\n}\nfunction maxValidDateStr(stns) {\n  return datetimeToLocalDateStr(maxValidDate(stns));\n}\nconst getNumberOfOccupants = (rsvs) => rsvs.reduce((n, rsv) => {\n  if (rsv.category === \"classroom\") {\n    return n + rsv.numStudents;\n  } else {\n    return rsv.resType === \"course\" ? n + 2 * Math.ceil(rsv.numStudents / 2) : n + 1;\n  }\n}, 0);\nexport {\n  minValidDateStr as a,\n  beforeCancelCutoff as b,\n  beforeResCutoff as c,\n  getNumberOfOccupants as d,\n  maxValidDateStr as e,\n  endTimes as f,\n  getStartEndTimes as g,\n  minuteOfDay as m,\n  startTimes as s\n};\n"],"names":[],"mappings":"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"}