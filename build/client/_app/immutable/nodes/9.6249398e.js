import{S as Re,i as Ve,s as Ne,k as v,q as z,a as L,l as g,m as w,r as G,h as m,c as F,n as b,$ as Ct,b as H,F as d,ai as Te,O as oe,Z as St,u as ie,D as ve,Q as Be,R as fe,a4 as Tt,ac as ge,aj as Pt,e as _e,_ as Bt,ag as Ce,g as te,v as Pe,d as ne,f as Me,o as It,y as ce,z as de,A as me,B as he,J as pe,P as Ut,T as Lt,C as Ft}from"../chunks/index.8e4fed50.js";import{p as Yt}from"../chunks/stores.c715e8c8.js";import{f as ze,O as Fe,g as Ge,h as Je,S as Mt,R as Ot,i as qe,s as jt,d as Ht,l as Wt,e as zt,j as Gt}from"../chunks/index.esm.a8d17a83.js";import{g as Qe}from"../chunks/firebase.81e41ff6.js";import{y as ye,k as Jt,z as qt,u as Qt,v as Rt,A as Xt,B as Xe,o as Ae,C as Zt,D as Kt,E as $t,d as xt,F as el,a as Ze,b as tl,l as ll,x as sl}from"../chunks/stores.cbfdd944.js";import{i as nl,t as Vt,M as Ke}from"../chunks/forms.ca44f84b.js";import{R as al}from"../chunks/RsvTabs.453366a9.js";import{L as ol,C as Ue,a as rl,g as Oe}from"../chunks/LoadingBar.e3e09623.js";import{_ as $e}from"../chunks/lodash.ee5632eb.js";const Nt=s=>s.sort((e,t)=>t.maxDepth-e.maxDepth);function il(s){return s.map(e=>Nt(e)).sort((e,t)=>t[0].maxDepth-e[0].maxDepth)}function fl(s){let e=[...s],t=[],l=(r,a)=>r.buddies.includes(a.user.id)&&r.buoy==a.buoy,n=(r,a)=>r.buoy!="auto"&&r.buoy==a.buoy;for(;e.length>0;){let r=e.splice(0,1)[0],a=[r];for(let i=e.length-1;i>=0;i--)(l(r,e[i])||n(r,e[i]))&&a.push(e.splice(i,1)[0]);t.push(a)}return il(t)}const xe=(s,e,t)=>{let l=s[0].maxDepth,n=e[e.length-1].maxDepth;return l-n>=t},Le=(s,e)=>{let t=s[0].buoy,l=e[0].buoy;return[t,l].includes("CBS")||[t,l].includes("PRO_SAFETY")?t===l:t==="auto"||l==="auto"||t===l};function ul(s,e){const t=[];for(let i=s.length-1;i>=0;i--){let u=s[i];(u[0].resType===ze.course||u.length>=3)&&t.push(s.splice(i,1)[0])}const l=(i,u)=>{const o=i.reduce((f,c)=>f.concat(c),[]);t.push(Nt(o));for(let f of u.sort().reverse())s.splice(f,1)},n=(i,u,o)=>{if(u==s.length)i.length==2?l([i],[0]):a(i[0]);else{let f=s[u];if(Le(i,f)){let c=i.length+f.length;xe(i,f,o)?i.length==2?l([i],[0]):l([i,f],[0,u]):c==2?r({curBg:i,nextBg:f,nextBgIdx:u,searchIdx:u+1,diffThresh:o}):c==3?l([i,f],[0,u]):n(i,u+1,o)}else n(i,u+1,o)}},r=({curBg:i,nextBg:u,nextBgIdx:o,searchIdx:f,diffThresh:c})=>{if(f==s.length)l([i,u],[0,o]);else{let p=s[f];xe(i,p,c)?l([i,u],[0,o]):Le(i,p)?p.length==1?l([i,u,p],[0,o,f]):l([i,p],[0,f]):r({curBg:i,nextBg:u,nextBgIdx:o,searchIdx:f+1,diffThresh:c})}},a=i=>{let u=!1;for(let o=t.length-1;o>=0;o--){let f=t[o];if(Le(f,[i])&&f[0].resType===ze.autonomous){if(f.length==2)f.push(i);else{let c=f.length-1;f.filter((_,A)=>_.buddies.length==1).length>0&&(c=f.reduce((_,A,E)=>A.buddies.length==0?E:_,c));let p=f.splice(c,1)[0];t.push([p,i])}u=!0;break}}u||t.push([i]),s.splice(0,1)};for(;s.length>0;)n(s[0],1,e);return t}function et(s,e){let t=fl(s);return ul(t,e)}function cl(s){let e={pulley:null,bottomPlate:!1,largeBuoy:!1};for(let t of s)e.pulley=e.pulley||t.pulley,e.bottomPlate=e.bottomPlate||t.bottomPlate,e.largeBuoy=e.largeBuoy||t.largeBuoy;return e}function tt(s,e){let t=0;return s.pulley&&e.pulley&&t++,s.bottomPlate&&e.bottomPlate&&t++,s.largeBuoy&&e.largeBuoy&&t++,t}function dl(s,e,t){const l=n=>n.reduce((r,a)=>r==="auto"?a.buoy:r,"auto");for(let n=e.length-1;n>=0;n--){const r=e[n],a=l(r);if(a!=="auto"){for(let i=s.length-1;i>=0;i--)if(s[i].name===a){t[a]=r,e.splice(n,1),s.splice(i,1);break}}}}function ml(s,e,t){const l=a=>(a.pulley?1:0)+(a.bottomPlate?1:0)+(a.largeBuoy?1:0),n=a=>Math.max(0,l(a)-l(t)),r=a=>a.maxDepth-e;s.sort((a,i)=>n(a.buoy)>n(i.buoy)?1:n(i.buoy)>n(a.buoy)?-1:r(a.buoy)-r(i.buoy))}function hl(s,e,t){for(s.sort((l,n)=>n.maxDepth-l.maxDepth),e.sort((l,n)=>l[0].maxDepth-n[0].maxDepth);e.length>0;){let l=e[e.length-1],n=l[0].maxDepth,r=cl(l),a=l[0].resType==="course"&&l[0].pulley==!1,i=s.map((f,c)=>({buoy:f,idx:c})),u=i.filter(f=>f.buoy.maxDepth>=n);if(u.length>0){if(i=u,a){let c=i.filter(p=>p.buoy.pulley==!1);c.length>0&&(i=c)}let f=i.reduce((c,p)=>{let _=tt(p.buoy,r);return _>c?_:c},0);i=i.filter(c=>tt(c.buoy,r)==f),ml(i,n,r)}let o=i[0];if(t[o.buoy.name]=l,e.splice(e.length-1,1),s.splice(o.idx,1),s.length==0)break}}function pl(s,e){let t={},l=[...s];return dl(l,e,t),hl(l,e,t),{assignments:t,unassigned:e.reduce((n,r)=>n.concat(r),[])}}function _l(s,e){const t=e.filter(a=>a.shortSession),l=e.filter(a=>!a.shortSession),n=15,r=[...et(t,n),...et(l,n)];return pl(s,r)}function lt(s,e){const{assignments:t,unassigned:l}=_l(s,e);return[...l,...Object.entries(t).flatMap(([r,a])=>a.map(i=>({...i,_buoy:r})))]}function bl(s){let e,t,l,n,r,a,i,u,o,f,c,p,_,A,E,Y,T,J,B,k,U,R,O,D,j,ee,S,M,V,Z,se,$,W,I,h,C;return{c(){e=v("form"),t=v("div"),l=z("buoy "),n=z(s[1]),r=L(),a=v("input"),i=L(),u=v("input"),o=L(),f=v("div"),c=v("div"),p=v("div"),_=v("label"),A=z("owTime"),E=L(),Y=v("div"),T=v("label"),J=z("Comments"),B=L(),k=v("div"),U=v("div"),R=v("select"),O=v("option"),D=z("AM"),j=v("option"),ee=z("PM"),S=L(),M=v("div"),V=v("textarea"),se=L(),$=v("div"),W=v("button"),I=z("Update"),this.h()},l(N){e=g(N,"FORM",{method:!0,action:!0});var P=w(e);t=g(P,"DIV",{class:!0});var x=w(t);l=G(x,"buoy "),n=G(x,s[1]),x.forEach(m),r=F(P),a=g(P,"INPUT",{type:!0,name:!0}),i=F(P),u=g(P,"INPUT",{type:!0,name:!0}),o=F(P),f=g(P,"DIV",{class:!0});var Q=w(f);c=g(Q,"DIV",{class:!0});var X=w(c);p=g(X,"DIV",{class:!0});var K=w(p);_=g(K,"LABEL",{for:!0,class:!0});var y=w(_);A=G(y,"owTime"),y.forEach(m),K.forEach(m),E=F(X),Y=g(X,"DIV",{class:!0});var q=w(Y);T=g(q,"LABEL",{for:!0,class:!0});var ae=w(T);J=G(ae,"Comments"),ae.forEach(m),q.forEach(m),X.forEach(m),B=F(Q),k=g(Q,"DIV",{class:!0});var ue=w(k);U=g(ue,"DIV",{});var le=w(U);R=g(le,"SELECT",{id:!0,name:!0});var re=w(R);O=g(re,"OPTION",{});var we=w(O);D=G(we,"AM"),we.forEach(m),j=g(re,"OPTION",{});var ke=w(j);ee=G(ke,"PM"),ke.forEach(m),re.forEach(m),le.forEach(m),S=F(ue),M=g(ue,"DIV",{});var Ee=w(M);V=g(Ee,"TEXTAREA",{id:!0,name:!0,class:!0,tabindex:!0}),w(V).forEach(m),Ee.forEach(m),ue.forEach(m),se=F(Q),$=g(Q,"DIV",{class:!0});var De=w($);W=g(De,"BUTTON",{type:!0,class:!0});var be=w(W);I=G(be,"Update"),be.forEach(m),De.forEach(m),Q.forEach(m),P.forEach(m),this.h()},h(){b(t,"class","form-title"),b(a,"type","hidden"),b(a,"name","date"),a.value=s[0],b(u,"type","hidden"),b(u,"name","buoy"),u.value=s[1],b(_,"for","owTime"),b(_,"class","dark:text-white"),b(p,"class","form-label h-8 mb-0.5"),b(T,"for","admin_comments"),b(T,"class","dark:text-white"),b(Y,"class","form-label h-8 mb-0.5"),b(c,"class","column text-right w-[33%]"),O.__value=Fe.AM,O.value=O.__value,j.__value=Fe.PM,j.value=j.__value,b(R,"id","owTime"),b(R,"name","owTime"),s[2]===void 0&&Ct(()=>s[6].call(R)),b(V,"id","adminComments"),b(V,"name","admin_comments"),b(V,"class","w-44 xs:w-52 flex-1 text-gray-700 dark:text-white"),V.value=Z=s[4](s[0],s[1],s[2],s[3]),b(V,"tabindex","4"),b(k,"class","column w-[67%]"),b(W,"type","submit"),b(W,"class","bg-gray-100 mt-1 px-3 py-1"),b($,"class","w-full inline-flex items-center justify-end"),b(f,"class","row m-4"),b(e,"method","POST"),b(e,"action","/?/adminCommentUpdate")},m(N,P){H(N,e,P),d(e,t),d(t,l),d(t,n),d(e,r),d(e,a),d(e,i),d(e,u),d(e,o),d(e,f),d(f,c),d(c,p),d(p,_),d(_,A),d(c,E),d(c,Y),d(Y,T),d(T,J),d(f,B),d(f,k),d(k,U),d(U,R),d(R,O),d(O,D),d(R,j),d(j,ee),Te(R,s[2],!0),d(k,S),d(k,M),d(M,V),d(f,se),d(f,$),d($,W),d(W,I),h||(C=[oe(R,"change",s[6]),St(nl.call(null,e,s[5]))],h=!0)},p(N,[P]){P&2&&ie(n,N[1]),P&1&&(a.value=N[0]),P&2&&(u.value=N[1]),P&4&&Te(R,N[2]),P&15&&Z!==(Z=N[4](N[0],N[1],N[2],N[3]))&&(V.value=Z)},i:ve,o:ve,d(N){N&&m(e),h=!1,Be(C)}}}function vl(s,e,t){let l,n;fe(s,ye,c=>t(3,n=c));let{date:r}=e,{buoy:a}=e;const{close:i}=Tt("simple-modal"),u=(c,p,_,A)=>{if(A[c]){for(let E of A[c])if(E.buoy==p&&E.am_pm==_)return E.comment}return""},o=async({form:c,data:p,action:_,cancel:A})=>(i(),async({result:E,update:Y})=>{switch(E.type){case"success":const T=E.data.record,J=Jt(T.date);for(let B=0;B<n[J].length;B++)if(n[J][B].id==T.id){n[J].splice(B,1);break}T.comment&&n[J].push(T),ge(ye,n={...n},n),qt(J,"adminComments");break;default:console.error(E),Vt.error("Update failed with unknown error!");break}});function f(){l=Pt(this),t(2,l)}return s.$$set=c=>{"date"in c&&t(0,r=c.date),"buoy"in c&&t(1,a=c.buoy)},t(2,l=Fe.AM),[r,a,l,n,u,o,f]}class gl extends Re{constructor(e){super(),Ve(this,e,vl,bl,Ne,{date:0,buoy:1})}}function st(s,e,t){const l=s.slice();return l[6]=e[t],l[8]=t,l}function nt(s){let e,t,l,n,r,a=$e.sortBy(s[0],"user.id"),i=[];for(let o=0;o<a.length;o+=1)i[o]=at(st(s,a,o));let u=s[3]&&ot(s);return{c(){e=v("div"),t=v("div");for(let o=0;o<i.length;o+=1)i[o].c();l=L(),u&&u.c(),this.h()},l(o){e=g(o,"DIV",{class:!0});var f=w(e);t=g(f,"DIV",{class:!0});var c=w(t);for(let p=0;p<i.length;p+=1)i[p].l(c);l=F(c),u&&u.l(c),c.forEach(m),f.forEach(m),this.h()},h(){b(t,"class","bg-gradient-to-br from-openwater-bg-from to-openwater-bg-to text-openwater-fg py-0.5 sm:py-2 pr-1 flex flex-col rounded-md cursor-pointer text-sm"),b(e,"class","text-center w-full")},m(o,f){H(o,e,f),d(e,t);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(t,null);d(t,l),u&&u.m(t,null),n||(r=oe(e,"click",function(){Bt(s[2])&&s[2].apply(this,arguments)}),n=!0)},p(o,f){if(s=o,f&19){a=$e.sortBy(s[0],"user.id");let c;for(c=0;c<a.length;c+=1){const p=st(s,a,c);i[c]?i[c].p(p,f):(i[c]=at(p),i[c].c(),i[c].m(t,l))}for(;c<i.length;c+=1)i[c].d(1);i.length=a.length}s[3]?u?u.p(s,f):(u=ot(s),u.c(),u.m(t,null)):u&&(u.d(1),u=null)},d(o){o&&m(e),Ce(i,o),u&&u.d(),n=!1,r()}}}function at(s){let e,t,l=Ge(s[6],s[1])+"",n,r,a,i,u,o;return{c(){e=v("div"),t=v("div"),n=z(l),a=L(),i=v("div"),u=v("span"),this.h()},l(f){e=g(f,"DIV",{class:!0});var c=w(e);t=g(c,"DIV",{class:!0});var p=w(t);n=G(p,l),p.forEach(m),a=F(c),i=g(c,"DIV",{class:!0});var _=w(i);u=g(_,"SPAN",{class:!0}),w(u).forEach(m),_.forEach(m),c.forEach(m),this.h()},h(){b(t,"class",r="flex-1 text-xs lg:text-base "+s[4](s[6])+" overflow-auto break-all"),b(u,"class",o="rsv-indicator "+Je([s[6]])),b(i,"class","pl-1 w-1"),b(e,"class","flex items-center w-full px-2")},m(f,c){H(f,e,c),d(e,t),d(t,n),d(e,a),d(e,i),d(i,u)},p(f,c){c&3&&l!==(l=Ge(f[6],f[1])+"")&&ie(n,l),c&1&&r!==(r="flex-1 text-xs lg:text-base "+f[4](f[6])+" overflow-auto break-all")&&b(t,"class",r),c&1&&o!==(o="rsv-indicator "+Je([f[6]]))&&b(u,"class",o)},d(f){f&&m(e)}}}function ot(s){let e,t,l;return{c(){e=v("p"),t=z("ADMIN: "),l=z(s[3]),this.h()},l(n){e=g(n,"P",{class:!0});var r=w(e);t=G(r,"ADMIN: "),l=G(r,s[3]),r.forEach(m),this.h()},h(){b(e,"class","flex flex-col text-sm p-0 text-gray-200")},m(n,r){H(n,e,r),d(e,t),d(e,l)},p(n,r){r&8&&ie(l,n[3])},d(n){n&&m(e)}}}function yl(s){let e,t=s[0].length&&nt(s);return{c(){t&&t.c(),e=_e()},l(l){t&&t.l(l),e=_e()},m(l,n){t&&t.m(l,n),H(l,e,n)},p(l,[n]){l[0].length?t?t.p(l,n):(t=nt(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ve,o:ve,d(l){t&&t.d(l),l&&m(e)}}}function wl(s,e,t){let l;fe(s,Qt,o=>t(5,l=o));let{submissions:n}=e,{adminView:r=!1}=e,{onClick:a=()=>{}}=e,{adminComment:i=""}=e;const u=o=>o.user.id===(l==null?void 0:l.id)?"border border-transparent rounded bg-lime-300 text-black":"";return s.$$set=o=>{"submissions"in o&&t(0,n=o.submissions),"adminView"in o&&t(1,r=o.adminView),"onClick"in o&&t(2,a=o.onClick),"adminComment"in o&&t(3,i=o.adminComment)},[n,r,a,i,u]}class rt extends Re{constructor(e){super(),Ve(this,e,wl,yl,Ne,{submissions:0,adminView:1,onClick:2,adminComment:3})}}function it(s,e,t){const l=s.slice();return l[32]=e[t],l[33]=e,l[34]=t,l}function ft(s,e,t){const l=s.slice();return l[35]=e[t],l}function ut(s,e,t){const l=s.slice();return l[35]=e[t],l}function ct(s,e,t){const l=s.slice();return l[35]=e[t],l}function dt(s){let e,t;return e=new ol({}),{c(){ce(e.$$.fragment)},l(l){de(e.$$.fragment,l)},m(l,n){me(e,l,n),t=!0},i(l){t||(te(e.$$.fragment,l),t=!0)},o(l){ne(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function mt(s){let e,t;return{c(){e=v("header"),t=z("Morning session is full please book in the afternoon instead."),this.h()},l(l){e=g(l,"HEADER",{class:!0});var n=w(e);t=G(n,"Morning session is full please book in the afternoon instead."),n.forEach(m),this.h()},h(){b(e,"class","bg-[#FF0000] text-white p-2 rounded-md")},m(l,n){H(l,e,n),d(e,t)},d(l){l&&m(e)}}}function kl(s){let e,t,l,n,r,a,i,u,o,f,c,p,_,A,E,Y,T,J,B,k=[],U=new Map,R,O=s[2]==="admin"&&ht(s),D=s[2]==="admin"&&_t(s),j=s[4];const ee=S=>S[32].id;for(let S=0;S<j.length;S+=1){let M=it(s,j,S),V=ee(M);U.set(V,k[S]=gt(V,M))}return{c(){e=v("section"),t=v("header"),l=v("div"),n=z("buoy"),r=L(),a=v("div"),i=z("boat"),u=L(),o=v("div"),f=v("span"),c=z("AM Count"),p=L(),O&&O.c(),_=L(),A=v("div"),E=v("span"),Y=z("PM Count"),T=L(),D&&D.c(),J=L(),B=v("ul");for(let S=0;S<k.length;S+=1)k[S].c();this.h()},l(S){e=g(S,"SECTION",{class:!0});var M=w(e);t=g(M,"HEADER",{class:!0});var V=w(t);l=g(V,"DIV",{class:!0});var Z=w(l);n=G(Z,"buoy"),Z.forEach(m),r=F(V),a=g(V,"DIV",{class:!0});var se=w(a);i=G(se,"boat"),se.forEach(m),u=F(V),o=g(V,"DIV",{class:!0});var $=w(o);f=g($,"SPAN",{});var W=w(f);c=G(W,"AM Count"),W.forEach(m),p=F($),O&&O.l($),$.forEach(m),_=F(V),A=g(V,"DIV",{class:!0});var I=w(A);E=g(I,"SPAN",{});var h=w(E);Y=G(h,"PM Count"),h.forEach(m),T=F(I),D&&D.l(I),I.forEach(m),V.forEach(m),J=F(M),B=g(M,"UL",{class:!0});var C=w(B);for(let N=0;N<k.length;N+=1)k[N].l(C);C.forEach(m),M.forEach(m),this.h()},h(){b(l,"class","flex-none w-12 min-w-12"),b(a,"class","flex-none text-center"),pe(a,"w-20",s[5]),pe(a,"w-8",!s[5]),b(o,"class","grow text-center"),b(A,"class","grow text-center"),b(t,"class","flex w-full gap-0.5 sm:gap-2 text-xs py-2"),b(B,"class","flex flex-col gap-0.5 sm:gap-3"),b(e,"class","w-full relative block")},m(S,M){H(S,e,M),d(e,t),d(t,l),d(l,n),d(t,r),d(t,a),d(a,i),d(t,u),d(t,o),d(o,f),d(f,c),d(o,p),O&&O.m(o,null),d(t,_),d(t,A),d(A,E),d(E,Y),d(A,T),D&&D.m(A,null),d(e,J),d(e,B);for(let V=0;V<k.length;V+=1)k[V]&&k[V].m(B,null);R=!0},p(S,M){(!R||M[0]&32)&&pe(a,"w-20",S[5]),(!R||M[0]&32)&&pe(a,"w-8",!S[5]),S[2]==="admin"?O?O.p(S,M):(O=ht(S),O.c(),O.m(o,null)):O&&(O.d(1),O=null),S[2]==="admin"?D?D.p(S,M):(D=_t(S),D.c(),D.m(A,null)):D&&(D.d(1),D=null),M[0]&1013&&(j=S[4],Pe(),k=Ut(k,M,ee,1,S,j,U,B,Lt,gt,null,it),Me())},i(S){if(!R){for(let M=0;M<j.length;M+=1)te(k[M]);R=!0}},o(S){for(let M=0;M<k.length;M+=1)ne(k[M]);R=!1},d(S){S&&m(e),O&&O.d(),D&&D.d();for(let M=0;M<k.length;M+=1)k[M].d()}}}function El(s){let e,t;return{c(){e=v("div"),t=z("Closed"),this.h()},l(l){e=g(l,"DIV",{class:!0});var n=w(e);t=G(n,"Closed"),n.forEach(m),this.h()},h(){b(e,"class","font-semibold text-3xl text-center")},m(l,n){H(l,e,n),d(e,t)},p:ve,i:ve,o:ve,d(l){l&&m(e)}}}function ht(s){let e,t=s[6],l=[];for(let n=0;n<t.length;n+=1)l[n]=pt(ct(s,t,n));return{c(){e=v("div");for(let n=0;n<l.length;n+=1)l[n].c();this.h()},l(n){e=g(n,"DIV",{class:!0});var r=w(e);for(let a=0;a<l.length;a+=1)l[a].l(r);r.forEach(m),this.h()},h(){b(e,"class","sm:text-xl whitespace-nowrap w-fit opacity-70 z-10 bg-gray-100 dark:bg-gray-400 rounded-lg border border-black dark:text-black px-1")},m(n,r){H(n,e,r);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(n,r){if(r[0]&80){t=n[6];let a;for(a=0;a<t.length;a+=1){const i=ct(n,t,a);l[a]?l[a].p(i,r):(l[a]=pt(i),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(n){n&&m(e),Ce(l,n)}}}function pt(s){let e,t=s[35]+"",l,n,r,a=s[4].filter(u).reduce(yt,0)+"",i;function u(...o){return s[12](s[35],...o)}return{c(){e=v("span"),l=z(t),n=L(),r=v("span"),i=z(a),this.h()},l(o){e=g(o,"SPAN",{class:!0});var f=w(e);l=G(f,t),f.forEach(m),n=F(o),r=g(o,"SPAN",{class:!0});var c=w(r);i=G(c,a),c.forEach(m),this.h()},h(){b(e,"class","font-bold ml-1"),b(r,"class","bg-teal-100 border border-black px-0.5")},m(o,f){H(o,e,f),d(e,l),H(o,n,f),H(o,r,f),d(r,i)},p(o,f){s=o,f[0]&64&&t!==(t=s[35]+"")&&ie(l,t),f[0]&80&&a!==(a=s[4].filter(u).reduce(yt,0)+"")&&ie(i,a)},d(o){o&&m(e),o&&m(n),o&&m(r)}}}function _t(s){let e,t=s[6],l=[];for(let n=0;n<t.length;n+=1)l[n]=bt(ut(s,t,n));return{c(){e=v("div");for(let n=0;n<l.length;n+=1)l[n].c();this.h()},l(n){e=g(n,"DIV",{class:!0});var r=w(e);for(let a=0;a<l.length;a+=1)l[a].l(r);r.forEach(m),this.h()},h(){b(e,"class","sm:text-xl whitespace-nowrap w-fit opacity-70 z-10 bg-gray-100 dark:bg-gray-400 rounded-lg border border-black dark:text-black px-1")},m(n,r){H(n,e,r);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(n,r){if(r[0]&80){t=n[6];let a;for(a=0;a<t.length;a+=1){const i=ut(n,t,a);l[a]?l[a].p(i,r):(l[a]=bt(i),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(n){n&&m(e),Ce(l,n)}}}function bt(s){let e,t=s[35]+"",l,n,r,a=s[4].filter(u).reduce(wt,0)+"",i;function u(...o){return s[13](s[35],...o)}return{c(){e=v("span"),l=z(t),n=L(),r=v("span"),i=z(a),this.h()},l(o){e=g(o,"SPAN",{class:!0});var f=w(e);l=G(f,t),f.forEach(m),n=F(o),r=g(o,"SPAN",{class:!0});var c=w(r);i=G(c,a),c.forEach(m),this.h()},h(){b(e,"class","font-bold ml-1"),b(r,"class","bg-teal-100 border border-black px-0.5")},m(o,f){H(o,e,f),d(e,l),H(o,n,f),H(o,r,f),d(r,i)},p(o,f){s=o,f[0]&64&&t!==(t=s[35]+"")&&ie(l,t),f[0]&80&&a!==(a=s[4].filter(u).reduce(wt,0)+"")&&ie(i,a)},d(o){o&&m(e),o&&m(n),o&&m(r)}}}function Dl(s){let e=(s[32].boat||"UNASSIGNED")+"",t;return{c(){t=z(e)},l(l){t=G(l,e)},m(l,n){H(l,t,n)},p(l,n){n[0]&16&&e!==(e=(l[32].boat||"UNASSIGNED")+"")&&ie(t,e)},d(l){l&&m(t)}}}function Al(s){let e,t,l,n,r,a,i=s[6],u=[];for(let f=0;f<i.length;f+=1)u[f]=vt(ft(s,i,f));function o(){s[15].call(e,s[33],s[34])}return{c(){e=v("select"),t=v("option");for(let f=0;f<u.length;f+=1)u[f].c();this.h()},l(f){e=g(f,"SELECT",{class:!0,name:!0,id:!0});var c=w(e);t=g(c,"OPTION",{}),w(t).forEach(m);for(let p=0;p<u.length;p+=1)u[p].l(c);c.forEach(m),this.h()},h(){t.__value="null",t.value=t.__value,b(e,"class","text-sm h-6 w-16 xs:text-xl xs:h-8 xs:w-16"),b(e,"name",l=s[32].buoy.name+"_boat"),b(e,"id",n=s[32].buoy.name+"_boat"),s[32].boat===void 0&&Ct(o)},m(f,c){H(f,e,c),d(e,t);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(e,null);Te(e,s[32].boat,!0),r||(a=[oe(e,"change",o),oe(e,"input",s[9])],r=!0)},p(f,c){if(s=f,c[0]&64){i=s[6];let p;for(p=0;p<i.length;p+=1){const _=ft(s,i,p);u[p]?u[p].p(_,c):(u[p]=vt(_),u[p].c(),u[p].m(e,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=i.length}c[0]&80&&l!==(l=s[32].buoy.name+"_boat")&&b(e,"name",l),c[0]&80&&n!==(n=s[32].buoy.name+"_boat")&&b(e,"id",n),c[0]&80&&Te(e,s[32].boat)},d(f){f&&m(e),Ce(u,f),r=!1,Be(a)}}}function vt(s){let e,t=s[35]+"",l,n;return{c(){e=v("option"),l=z(t),this.h()},l(r){e=g(r,"OPTION",{});var a=w(e);l=G(a,t),a.forEach(m),this.h()},h(){e.__value=n=s[35],e.value=e.__value},m(r,a){H(r,e,a),d(e,l)},p(r,a){a[0]&64&&t!==(t=r[35]+"")&&ie(l,t),a[0]&64&&n!==(n=r[35])&&(e.__value=n,e.value=e.__value)},d(r){r&&m(e)}}}function gt(s,e){let t,l,n,r,a=e[32].buoy.name+"",i,u,o,f,c,p=qe(e[32].buoy)+"",_,A,E,Y,T,J,B,k,U,R,O,D,j,ee;function S(){return e[14](e[32])}function M(W,I){return W[2]==="admin"?Al:Dl}let V=M(e),Z=V(e);function se(){return e[16](e[32])}B=new rt({props:{submissions:e[32].amReservations||[],onClick:se,adminComment:e[32].amAdminComment,adminView:e[5]}});function $(){return e[17](e[32])}return R=new rt({props:{submissions:e[32].pmReservations||[],onClick:$,adminComment:e[32].pmAdminComment,adminView:e[5]}}),{key:s,first:null,c(){t=v("li"),l=v("div"),n=v("div"),r=v("span"),i=z(a),u=L(),o=v("br"),f=L(),c=v("span"),_=z(p),A=L(),E=v("div"),Z.c(),Y=L(),T=v("div"),J=v("div"),ce(B.$$.fragment),k=L(),U=v("div"),ce(R.$$.fragment),O=L(),this.h()},l(W){t=g(W,"LI",{class:!0});var I=w(t);l=g(I,"DIV",{class:!0});var h=w(l);n=g(h,"DIV",{class:!0});var C=w(n);r=g(C,"SPAN",{});var N=w(r);i=G(N,a),N.forEach(m),u=F(C),o=g(C,"BR",{}),f=F(C),c=g(C,"SPAN",{class:!0});var P=w(c);_=G(P,p),P.forEach(m),C.forEach(m),h.forEach(m),A=F(I),E=g(I,"DIV",{class:!0});var x=w(E);Z.l(x),x.forEach(m),Y=F(I),T=g(I,"DIV",{class:!0});var Q=w(T);J=g(Q,"DIV",{class:!0});var X=w(J);de(B.$$.fragment,X),X.forEach(m),k=F(Q),U=g(Q,"DIV",{class:!0});var K=w(U);de(R.$$.fragment,K),K.forEach(m),Q.forEach(m),O=F(I),I.forEach(m),this.h()},h(){b(c,"class","text-xs"),b(n,"class","cursor-pointer font-semibold"),b(l,"class","flex-none w-12 min-w-12"),b(E,"class","flex-none px-2 text-center"),pe(E,"w-20",e[5]),pe(E,"w-8",!e[5]),b(J,"class","w-1/2"),b(U,"class","w-1/2"),b(T,"class","grow flex w-auto relative gap-0.5 sm:gap-2"),b(t,"class","flex items-center w-full gap-0.5 sm:gap-2 border-b-[1px] border-gray-200 border-opacity-20 pb-0.5 sm:pb-2"),this.first=t},m(W,I){H(W,t,I),d(t,l),d(l,n),d(n,r),d(r,i),d(n,u),d(n,o),d(n,f),d(n,c),d(c,_),d(t,A),d(t,E),Z.m(E,null),d(t,Y),d(t,T),d(T,J),me(B,J,null),d(T,k),d(T,U),me(R,U,null),d(t,O),D=!0,j||(ee=oe(n,"click",S),j=!0)},p(W,I){e=W,(!D||I[0]&16)&&a!==(a=e[32].buoy.name+"")&&ie(i,a),(!D||I[0]&16)&&p!==(p=qe(e[32].buoy)+"")&&ie(_,p),V===(V=M(e))&&Z?Z.p(e,I):(Z.d(1),Z=V(e),Z&&(Z.c(),Z.m(E,null))),(!D||I[0]&32)&&pe(E,"w-20",e[5]),(!D||I[0]&32)&&pe(E,"w-8",!e[5]);const h={};I[0]&16&&(h.submissions=e[32].amReservations||[]),I[0]&16&&(h.onClick=se),I[0]&16&&(h.adminComment=e[32].amAdminComment),I[0]&32&&(h.adminView=e[5]),B.$set(h);const C={};I[0]&16&&(C.submissions=e[32].pmReservations||[]),I[0]&16&&(C.onClick=$),I[0]&16&&(C.adminComment=e[32].pmAdminComment),I[0]&32&&(C.adminView=e[5]),R.$set(C)},i(W){D||(te(B.$$.fragment,W),te(R.$$.fragment,W),D=!0)},o(W){ne(B.$$.fragment,W),ne(R.$$.fragment,W),D=!1},d(W){W&&m(t),Z.d(),he(B),he(R),j=!1,ee()}}}function Cl(s){let e,t,l,n,r,a,i,u=s[3]&&dt(),o=s[1]&&mt();const f=[El,kl],c=[];function p(_,A){return A[0]&1&&(l=null),l==null&&(l=Mt.getOpenForBusiness(_[0])===!1),l?0:1}return n=p(s,[-1,-1]),r=c[n]=f[n](s),{c(){u&&u.c(),e=L(),o&&o.c(),t=L(),r.c(),a=_e()},l(_){u&&u.l(_),e=F(_),o&&o.l(_),t=F(_),r.l(_),a=_e()},m(_,A){u&&u.m(_,A),H(_,e,A),o&&o.m(_,A),H(_,t,A),c[n].m(_,A),H(_,a,A),i=!0},p(_,A){_[3]?u?A[0]&8&&te(u,1):(u=dt(),u.c(),te(u,1),u.m(e.parentNode,e)):u&&(Pe(),ne(u,1,1,()=>{u=null}),Me()),_[1]?o||(o=mt(),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null);let E=n;n=p(_,A),n===E?c[n].p(_,A):(Pe(),ne(c[E],1,1,()=>{c[E]=null}),Me(),r=c[n],r?r.p(_,A):(r=c[n]=f[n](_),r.c()),te(r,1),r.m(a.parentNode,a))},i(_){i||(te(u),te(r),i=!0)},o(_){ne(u),ne(r),i=!1},d(_){u&&u.d(_),_&&m(e),o&&o.d(_),_&&m(t),c[n].d(_),_&&m(a)}}}const yt=(s,e)=>s+e.amHeadCount,wt=(s,e)=>s+e.pmHeadCount;function Sl(s,e,t){let l,n,r,a,i,u;fe(s,Rt,h=>t(2,r=h)),fe(s,Xt,h=>t(22,a=h)),fe(s,ye,h=>t(23,i=h)),fe(s,Xe,h=>t(24,u=h));let{date:o=Ae().format("YYYY-MM-DD")}=e,{isAmFull:f=!1}=e,{refreshTs:c=Date.now()}=e,{onUpdateReservations:p}=e,_=!1,A=0,E=0,Y=[],T={};const{open:J}=Tt("simple-modal"),B=h=>{J(al,{rsvs:h,hasForm:!0,disableModify:r==="admin",onSubmit:()=>{j()}})},k=(h,C)=>{J(gl,{date:h,buoy:C})},U=async()=>{o?(ge(ye,i[o]=await Kt(o),i),ge(ye,i={...i},i)):ge(ye,i[o]=[],i)},R=async()=>{const h=await $t(o,Ot.openwater);h.reservations&&(Y=h.reservations,ge(Xe,u=Y,u)),p(Y)},O=async()=>{const h=await el(o);h.status==="success"&&(T=h.assignments||{})},D=async h=>{h.target.blur();let C=h.target.id.split("_")[0],N=h.target.value;N==="null"&&(N=null);const P={...T,[C]:N};let Q=await(await fetch("/api/assignBuoysToBoats",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({date:o,assignments:P})})).json();Q.status==="success"&&(T=JSON.parse(Q.record.assignments)),ee()},j=async()=>{A=0,E=0,E=0,t(3,_=!0),await Promise.all([U(),R(),O(),xt()]),ee(),t(3,_=!1)},ee=async()=>{if(t(3,_=!0),Y&&a.length){const h=lt(a,Y.filter(P=>P.owTime==="AM")),C=lt(a,Y.filter(P=>P.owTime==="PM")),N=i[o]||[];t(4,S=[...a].map(P=>{const x=N.find(y=>y.buoy===P.name&&y.am_pm==="AM"),Q=N.find(y=>y.buoy===P.name&&y.am_pm==="PM"),X=h.filter(y=>y._buoy===P.name),K=C.filter(y=>y._buoy===P.name);return{id:`group_${P.name}`,buoy:P,boat:(T==null?void 0:T[P.name])||null,amReservations:X,pmReservations:C.filter(y=>y._buoy===P.name),amAdminComment:x==null?void 0:x.comment,pmAdminComment:Q==null?void 0:Q.comment,amHeadCount:M(X),pmHeadCount:M(K)}}).sort((P,x)=>+(P.boat||0)-+(x.boat||0)).filter(P=>P.amReservations.length>0||P.pmReservations.length>0))}t(3,_=!1)};let S=[];const M=h=>h.reduce((C,N)=>C+(N.resType==="course"?N.numStudents+1:1),0);It(async()=>{o&&await j()}),Zt.subscribe(async h=>{var N,P,x,Q;t(3,_=!0);const C=[];((N=h[o])==null?void 0:N.adminComments)!==A&&(A=((P=h[o])==null?void 0:P.adminComments)||0,C.push(U())),((x=h[o])==null?void 0:x.reservations)!==E&&(E=((Q=h[o])==null?void 0:Q.reservations)||0,C.push(R())),await Promise.all(C),ee()});const V=(h,C)=>C.boat===h,Z=(h,C)=>C.boat===h,se=h=>n&&k(o,h.buoy.name);function $(h,C){h[C].boat=Pt(this),t(4,S),t(6,l),t(0,o)}const W=h=>{B(h.amReservations||[])},I=h=>{B(h.pmReservations||[])};return s.$$set=h=>{"date"in h&&t(0,o=h.date),"isAmFull"in h&&t(1,f=h.isAmFull),"refreshTs"in h&&t(10,c=h.refreshTs),"onUpdateReservations"in h&&t(11,p=h.onUpdateReservations)},s.$$.update=()=>{s.$$.dirty[0]&1&&t(6,l=Mt.getBoats(o)),s.$$.dirty[0]&4&&t(5,n=r==="admin"),s.$$.dirty[0]&1025&&(o||c)&&j()},[o,f,r,_,S,n,l,B,k,D,c,p,V,Z,se,$,W,I]}class Tl extends Re{constructor(e){super(),Ve(this,e,Sl,Cl,Ne,{date:0,isAmFull:1,refreshTs:10,onUpdateReservations:11},null,[-1,-1])}}function kt(s,e,t){const l=s.slice();return l[32]=e[t],l}function Et(s){let e,t,l,n,r,a,i,u,o,f,c,p,_,A,E,Y=Ae(s[0].day).format("MMMM DD, YYYY dddd")+"",T,J,B,k,U,R,O,D,j,ee,S,M,V,Z,se,$,W,I,h,C,N,P,x,Q=s[10],X=[];for(let y=0;y<Q.length;y+=1)X[y]=Dt(kt(s,Q,y));f=new Ue({props:{direction:"left",svgClass:"h-8 w-8"}}),_=new Ue({props:{direction:"right",svgClass:"h-8 w-8"}}),k=new Ke({props:{$$slots:{default:[Ml]},$$scope:{ctx:s}}}),k.$on("open",s[20]),k.$on("close",s[21]),S=new Ue({props:{direction:"left"}});let K=s[9]==="admin"&&At(s);return C=new Ke({props:{$$slots:{default:[Ol]},$$scope:{ctx:s}}}),C.$on("open",s[25]),C.$on("close",s[26]),{c(){e=v("div"),t=v("div"),l=v("label"),n=z("Openwater"),r=L(),a=v("ul");for(let y=0;y<X.length;y+=1)X[y].c();i=L(),u=v("div"),o=v("span"),ce(f.$$.fragment),c=L(),p=v("span"),ce(_.$$.fragment),A=L(),E=v("span"),T=z(Y),J=L(),B=v("span"),ce(k.$$.fragment),U=L(),R=v("br"),O=L(),D=v("div"),j=v("a"),ee=v("span"),ce(S.$$.fragment),M=L(),V=v("span"),Z=z("month view"),se=L(),K&&K.c(),$=L(),W=v("br"),I=L(),h=v("div"),ce(C.$$.fragment),this.h()},l(y){e=g(y,"DIV",{class:!0});var q=w(e);t=g(q,"DIV",{class:!0});var ae=w(t);l=g(ae,"LABEL",{tabindex:!0,class:!0});var ue=w(l);n=G(ue,"Openwater"),ue.forEach(m),r=F(ae),a=g(ae,"UL",{tabindex:!0,class:!0});var le=w(a);for(let Ie=0;Ie<X.length;Ie+=1)X[Ie].l(le);le.forEach(m),ae.forEach(m),i=F(q),u=g(q,"DIV",{class:!0});var re=w(u);o=g(re,"SPAN",{class:!0});var we=w(o);de(f.$$.fragment,we),we.forEach(m),c=F(re),p=g(re,"SPAN",{class:!0});var ke=w(p);de(_.$$.fragment,ke),ke.forEach(m),A=F(re),E=g(re,"SPAN",{class:!0});var Ee=w(E);T=G(Ee,Y),Ee.forEach(m),re.forEach(m),J=F(q),B=g(q,"SPAN",{class:!0});var De=w(B);de(k.$$.fragment,De),De.forEach(m),q.forEach(m),U=F(y),R=g(y,"BR",{}),O=F(y),D=g(y,"DIV",{class:!0});var be=w(D);j=g(be,"A",{class:!0,href:!0});var Se=w(j);ee=g(Se,"SPAN",{});var je=w(ee);de(S.$$.fragment,je),je.forEach(m),M=F(Se),V=g(Se,"SPAN",{class:!0});var He=w(V);Z=G(He,"month view"),He.forEach(m),Se.forEach(m),se=F(be),K&&K.l(be),be.forEach(m),$=F(y),W=g(y,"BR",{}),I=F(y),h=g(y,"DIV",{class:!0});var We=w(h);de(C.$$.fragment,We),We.forEach(m),this.h()},h(){b(l,"tabindex","0"),b(l,"class","border border-gray-200 dark:border-gray-700 btn btn-fsh-dropdown"),b(a,"tabindex","0"),b(a,"class","dropdown-content menu p-0 shadow bg-base-100 rounded-box w-fit"),b(t,"class","dropdown h-8 mb-4"),b(o,"class","cursor-pointer"),b(p,"class","cursor-pointer"),b(E,"class","text-2xl ml-2"),b(u,"class","inline-flex items-center justify-between"),b(B,"class","mr-2"),b(e,"class","[&>*]:mx-auto flex items-center justify-between"),b(V,"class","xs:text-xl pb-1 whitespace-nowrap"),b(j,"class","inline-flex items-center border border-solid border-transparent hover:border-black rounded-lg pl-1.5 pr-4 py-0 hover:text-white hover:bg-gray-700"),b(j,"href","/multi-day/openwater"),b(D,"class","flex justify-between"),b(h,"class","w-full min-h-[500px]")},m(y,q){H(y,e,q),d(e,t),d(t,l),d(l,n),d(t,r),d(t,a);for(let ae=0;ae<X.length;ae+=1)X[ae]&&X[ae].m(a,null);d(e,i),d(e,u),d(u,o),me(f,o,null),d(u,c),d(u,p),me(_,p,null),d(u,A),d(u,E),d(E,T),d(e,J),d(e,B),me(k,B,null),H(y,U,q),H(y,R,q),H(y,O,q),H(y,D,q),d(D,j),d(j,ee),me(S,ee,null),d(j,M),d(j,V),d(V,Z),d(D,se),K&&K.m(D,null),H(y,$,q),H(y,W,q),H(y,I,q),H(y,h,q),me(C,h,null),N=!0,P||(x=[oe(o,"click",s[12]),oe(o,"keypress",s[12]),oe(p,"click",s[13]),oe(p,"keypress",s[13]),St(jt.call(null,h,{timeframe:300,minSwipeDistance:10,touchAction:"pan-y"})),oe(h,"swipe",s[14])],P=!0)},p(y,q){if(q[0]&1025){Q=y[10];let le;for(le=0;le<Q.length;le+=1){const re=kt(y,Q,le);X[le]?X[le].p(re,q):(X[le]=Dt(re),X[le].c(),X[le].m(a,null))}for(;le<X.length;le+=1)X[le].d(1);X.length=Q.length}(!N||q[0]&1)&&Y!==(Y=Ae(y[0].day).format("MMMM DD, YYYY dddd")+"")&&ie(T,Y);const ae={};q[0]&5|q[1]&16&&(ae.$$scope={dirty:q,ctx:y}),k.$set(ae),y[9]==="admin"?K?K.p(y,q):(K=At(y),K.c(),K.m(D,null)):K&&(K.d(1),K=null);const ue={};q[0]&23|q[1]&16&&(ue.$$scope={dirty:q,ctx:y}),C.$set(ue)},i(y){N||(te(f.$$.fragment,y),te(_.$$.fragment,y),te(k.$$.fragment,y),te(S.$$.fragment,y),te(C.$$.fragment,y),N=!0)},o(y){ne(f.$$.fragment,y),ne(_.$$.fragment,y),ne(k.$$.fragment,y),ne(S.$$.fragment,y),ne(C.$$.fragment,y),N=!1},d(y){y&&m(e),Ce(X,y),he(f),he(_),he(k),y&&m(U),y&&m(R),y&&m(O),y&&m(D),he(S),K&&K.d(),y&&m($),y&&m(W),y&&m(I),y&&m(h),he(C),P=!1,Be(x)}}}function Pl(s){let e,t,l=s[32]+"",n,r,a;return{c(){e=v("li"),t=v("a"),n=z(l),a=L(),this.h()},l(i){e=g(i,"LI",{});var u=w(e);t=g(u,"A",{class:!0,href:!0});var o=w(t);n=G(o,l),o.forEach(m),a=F(u),u.forEach(m),this.h()},h(){b(t,"class","text-xl active:bg-gray-300"),b(t,"href",r=Oe(s[32],s[0].day))},m(i,u){H(i,e,u),d(e,t),d(t,n),d(e,a)},p(i,u){u[0]&1&&r!==(r=Oe(i[32],i[0].day))&&b(t,"href",r)},d(i){i&&m(e)}}}function Dt(s){let e,t=s[32]!==Ye&&Pl(s);return{c(){t&&t.c(),e=_e()},l(l){t&&t.l(l),e=_e()},m(l,n){t&&t.m(l,n),H(l,e,n)},p(l,n){l[32]!==Ye&&t.p(l,n)},d(l){t&&t.d(l),l&&m(e)}}}function Ml(s){let e,t;return e=new Ht({props:{category:Ye,dateFn:s[18],onUpdate:s[19]}}),{c(){ce(e.$$.fragment)},l(l){de(e.$$.fragment,l)},m(l,n){me(e,l,n),t=!0},p(l,n){const r={};n[0]&1&&(r.dateFn=l[18]),n[0]&4&&(r.onUpdate=l[19]),e.$set(r)},i(l){t||(te(e.$$.fragment,l),t=!0)},o(l){ne(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function At(s){let e,t,l,n,r,a,i,u,o,f,c,p=s[4]?"not":"",_,A,E,Y,T,J,B;return{c(){e=v("div"),t=v("button"),l=z("Lock"),r=L(),a=v("button"),i=z("Unlock"),o=L(),f=v("button"),c=z("mark morning as "),_=z(p),A=z(" full"),E=L(),Y=v("button"),T=z("Approve All"),this.h()},l(k){e=g(k,"DIV",{class:!0});var U=w(e);t=g(U,"BUTTON",{class:!0});var R=w(t);l=G(R,"Lock"),R.forEach(m),r=F(U),a=g(U,"BUTTON",{class:!0});var O=w(a);i=G(O,"Unlock"),O.forEach(m),o=F(U),f=g(U,"BUTTON",{class:!0});var D=w(f);c=G(D,"mark morning as "),_=G(D,p),A=G(D," full"),D.forEach(m),E=F(U),Y=g(U,"BUTTON",{class:!0});var j=w(Y);T=G(j,"Approve All"),j.forEach(m),U.forEach(m),this.h()},h(){b(t,"class",n=s[11](s[6])+" px-1 py-0 font-semibold border-black dark:border-white"),b(a,"class",u=s[11](s[5])+" px-1 py-0 font-semibold border-black dark:border-white"),b(f,"class","bg-root-bg-light dark:bg-root-bg-dark px-1 py-0 font-semibold border-black dark:border-white"),b(Y,"class","bg-root-bg-light dark:bg-root-bg-dark px-1 py-0 font-semibold border-black dark:border-white"),b(e,"class","flex gap-2")},m(k,U){H(k,e,U),d(e,t),d(t,l),d(e,r),d(e,a),d(a,i),d(e,o),d(e,f),d(f,c),d(f,_),d(f,A),d(e,E),d(e,Y),d(Y,T),J||(B=[oe(t,"click",s[15]),oe(a,"click",s[16]),oe(f,"click",s[22]),oe(Y,"click",s[23])],J=!0)},p(k,U){U[0]&64&&n!==(n=k[11](k[6])+" px-1 py-0 font-semibold border-black dark:border-white")&&b(t,"class",n),U[0]&32&&u!==(u=k[11](k[5])+" px-1 py-0 font-semibold border-black dark:border-white")&&b(a,"class",u),U[0]&16&&p!==(p=k[4]?"not":"")&&ie(_,p)},d(k){k&&m(e),J=!1,Be(B)}}}function Ol(s){let e,t;return e=new Tl({props:{date:s[0].day,isAmFull:s[4],refreshTs:s[2],onUpdateReservations:s[24]}}),{c(){ce(e.$$.fragment)},l(l){de(e.$$.fragment,l)},m(l,n){me(e,l,n),t=!0},p(l,n){const r={};n[0]&1&&(r.date=l[0].day),n[0]&16&&(r.isAmFull=l[4]),n[0]&4&&(r.refreshTs=l[2]),n[0]&2&&(r.onUpdateReservations=l[24]),e.$set(r)},i(l){t||(te(e.$$.fragment,l),t=!0)},o(l){ne(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function Rl(s){let e,t,l=s[7]&&s[8]==="in"&&Et(s);return{c(){l&&l.c(),e=_e()},l(n){l&&l.l(n),e=_e()},m(n,r){l&&l.m(n,r),H(n,e,r),t=!0},p(n,r){n[7]&&n[8]==="in"?l?(l.p(n,r),r[0]&384&&te(l,1)):(l=Et(n),l.c(),te(l,1),l.m(e.parentNode,e)):l&&(Pe(),ne(l,1,1,()=>{l=null}),Me())},i(n){t||(te(l),t=!0)},o(n){ne(l),t=!1},d(n){l&&l.d(n),n&&m(e)}}}const Ye="openwater";function Vl(s,e,t){let l,n,r,a,i,u,o;fe(s,Yt,h=>t(17,r=h)),fe(s,Ze,h=>t(29,a=h)),fe(s,tl,h=>t(7,i=h)),fe(s,ll,h=>t(8,u=h)),fe(s,Rt,h=>t(9,o=h));let{data:f}=e,c=[...rl],p=Date.now(),_=[];const A=h=>h?"bg-openwater-bg-to text-white":"bg-root-bg-light dark:bg-root-bg-dark";ge(Ze,a="single-day",a);function E(){const h=Ae(f.day).subtract(1,"day");Qe(Oe("openwater",h.format("YYYY-MM-DD")))}function Y(){const h=Ae(f.day).add(1,"day");Qe(Oe("openwater",h.format("YYYY-MM-DD")))}let T=!1;function J(h){T||(h.detail.direction==="left"?Y():h.detail.direction==="right"&&E())}const B=async h=>{const C=f.day,N=async()=>{let x=await(await fetch("/api/lockBuoyAssignments",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({lock:h,date:C})})).json();return x.status==="success"?(t(2,p=Date.now()),t(1,_=x.reservations),Promise.resolve()):(console.error(x.error),Promise.reject())};Vt.promise(N(),{error:"buoy lock failed"})},k=async()=>B(!0),U=async()=>B(!1);let R=!1,O,D;function j(){O&&O(),D&&D(),O=Wt(new Date(f.day),h=>{t(4,R=!!h.ow_am_full)}),D=zt(new Date(f.day),"openwater",()=>{t(2,p=Date.now())})}Ft(()=>{O&&O(),D&&D()});const ee=()=>f.day,S=()=>{t(2,p=Date.now())},M=()=>t(3,T=!0),V=()=>{t(3,T=!1),t(2,p=Date.now())},Z=()=>{Gt(new Date(f.day),!R)},se=async()=>{await sl(Ot.openwater,f.day)},$=h=>{t(1,_=h)},W=()=>t(3,T=!0),I=()=>t(3,T=!1);return s.$$set=h=>{"data"in h&&t(0,f=h.data)},s.$$.update=()=>{s.$$.dirty[0]&2&&t(6,l=_.every(h=>h.buoy!=="auto")),s.$$.dirty[0]&2&&t(5,n=_.every(h=>h.buoy==="auto")),s.$$.dirty[0]&131072&&j()},[f,_,p,T,R,n,l,i,u,o,c,A,E,Y,J,k,U,r,ee,S,M,V,Z,se,$,W,I]}class Wl extends Re{constructor(e){super(),Ve(this,e,Vl,Rl,Ne,{data:0},null,[-1,-1])}}export{Wl as component};
