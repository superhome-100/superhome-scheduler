import{S as ye,i as we,s as De,$ as Ie,a as E,e as N,c as S,b as v,O as de,g as W,v as Ee,d as j,f as Se,h as m,R as Q,a4 as Te,y as Ve,z as Ce,A as Me,B as Re,k,l as y,m as w,p as C,n as D,F as p,ag as q,q as L,r as z,D as Ne,u as A,_ as Pe}from"./index.8e4fed50.js";import{k as Be,S as F,n as U,o as X,R as Y,h as Z}from"./index.esm.a8d17a83.js";import{c as Le,v as ze,k as G,t as x,E as Fe}from"./stores.cbfdd944.js";import{R as He}from"./RsvTabs.453366a9.js";import{L as We}from"./LoadingBar.e3e09623.js";function $(i,e,l){const t=i.slice();return t[20]=e[l],t[22]=l,t}function ee(i,e,l){const t=i.slice();return t[23]=e[l],t}function te(i,e,l){const t=i.slice();return t[26]=e[l],t}function le(i,e,l){const t=i.slice();return t[29]=e[l],t}function se(i){let e,l;return e=new We({}),{c(){Ve(e.$$.fragment)},l(t){Ce(e.$$.fragment,t)},m(t,s){Me(e,t,s),l=!0},i(t){l||(W(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){Re(e,t)}}}function qe(i){let e,l,t,s,r,n,a=i[7].status==="error"&&ie(),u=i[9](i[2],i[1]),d=[];for(let f=0;f<u.length;f+=1)d[f]=ne(le(i,u,f));let c=i[0].resources,o=[];for(let f=0;f<c.length;f+=1)o[f]=he($(i,c,f));return{c(){a&&a.c(),e=E(),l=k("div"),t=k("div"),s=k("div"),r=E();for(let f=0;f<d.length;f+=1)d[f].c();n=E();for(let f=0;f<o.length;f+=1)o[f].c();this.h()},l(f){a&&a.l(f),e=S(f),l=y(f,"DIV",{class:!0});var _=w(l);t=y(_,"DIV",{class:!0});var h=w(t);s=y(h,"DIV",{style:!0}),w(s).forEach(m),r=S(h);for(let b=0;b<d.length;b+=1)d[b].l(h);h.forEach(m),n=S(_);for(let b=0;b<o.length;b+=1)o[b].l(_);_.forEach(m),this.h()},h(){C(s,"height","1lh"),D(t,"class","column w-[12%] m-0 text-center"),D(l,"class","row text-xs sm:text-base")},m(f,_){a&&a.m(f,_),v(f,e,_),v(f,l,_),p(l,t),p(t,s),p(t,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(t,null);p(l,n);for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(l,null)},p(f,_){if(f[7].status==="error"?a||(a=ie(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),_[0]&518){u=f[9](f[2],f[1]);let h;for(h=0;h<u.length;h+=1){const b=le(f,u,h);d[h]?d[h].p(b,_):(d[h]=ne(b),d[h].c(),d[h].m(t,null))}for(;h<d.length;h+=1)d[h].d(1);d.length=u.length}if(_[0]&3555){c=f[0].resources;let h;for(h=0;h<c.length;h+=1){const b=$(f,c,h);o[h]?o[h].p(b,_):(o[h]=he(b),o[h].c(),o[h].m(l,null))}for(;h<o.length;h+=1)o[h].d(1);o.length=c.length}},d(f){a&&a.d(f),f&&m(e),f&&m(l),q(d,f),q(o,f)}}}function Ae(i){let e,l;return{c(){e=k("div"),l=L("Closed"),this.h()},l(t){e=y(t,"DIV",{class:!0});var s=w(e);l=z(s,"Closed"),s.forEach(m),this.h()},h(){D(e,"class","font-semibold text-3xl text-center")},m(t,s){v(t,e,s),p(e,l)},p:Ne,d(t){t&&m(e)}}}function ie(i){let e,l,t,s,r;return{c(){e=k("div"),l=L("Error assigning reservations!"),t=E(),s=k("div"),r=L("Please report this error to the admin"),this.h()},l(n){e=y(n,"DIV",{class:!0});var a=w(e);l=z(a,"Error assigning reservations!"),a.forEach(m),t=S(n),s=y(n,"DIV",{class:!0});var u=w(s);r=z(u,"Please report this error to the admin"),u.forEach(m),this.h()},h(){D(e,"class","font-semibold text-red-600 text-xl text-center"),D(s,"class","text-sm text-center mb-4")},m(n,a){v(n,e,a),p(e,l),v(n,t,a),v(n,s,a),p(s,r)},d(n){n&&m(e),n&&m(t),n&&m(s)}}}function ne(i){let e,l=i[29]+"",t;return{c(){e=k("div"),t=L(l),this.h()},l(s){e=y(s,"DIV",{class:!0,style:!0});var r=w(e);t=z(r,l),r.forEach(m),this.h()},h(){D(e,"class","font-semibold"),C(e,"height",H+"rem")},m(s,r){v(s,e,r),p(e,t)},p(s,r){r[0]&6&&l!==(l=s[29]+"")&&A(t,l)},d(s){s&&m(e)}}}function re(i){let e,l,t,s=i[7].schedule[i[22]],r=[];for(let n=0;n<s.length;n+=1)r[n]=ce(ee(i,s,n));return{c(){e=k("div"),l=E();for(let n=0;n<r.length;n+=1)r[n].c();t=N(),this.h()},l(n){e=y(n,"DIV",{style:!0}),w(e).forEach(m),l=S(n);for(let a=0;a<r.length;a+=1)r[a].l(n);t=N(),this.h()},h(){C(e,"height","0.5rem")},m(n,a){v(n,e,a),v(n,l,a);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(n,a);v(n,t,a)},p(n,a){if(a[0]&3554){s=n[7].schedule[n[22]];let u;for(u=0;u<s.length;u+=1){const d=ee(n,s,u);r[u]?r[u].p(d,a):(r[u]=ce(d),r[u].c(),r[u].m(t.parentNode,t))}for(;u<r.length;u+=1)r[u].d(1);r.length=s.length}},d(n){n&&m(e),n&&m(l),q(r,n),n&&m(t)}}}function Oe(i){let e;return{c(){e=k("div"),this.h()},l(l){e=y(l,"DIV",{style:!0}),w(e).forEach(m),this.h()},h(){C(e,"height",H*(i[23].nSlots/i[6])+"rem")},m(l,t){v(l,e,t)},p(l,t){t[0]&192&&C(e,"height",H*(l[23].nSlots/l[6])+"rem")},d(l){l&&m(e)}}}function je(i){let e,l,t=["single","end"].includes(i[23].styleType),s,r=["single","start"].includes(i[23].styleType),n,a,u,d,c=t&&oe(i),o=r&&fe(i);return{c(){e=k("div"),l=k("div"),c&&c.c(),s=E(),o&&o.c(),n=E(),this.h()},l(f){e=y(f,"DIV",{class:!0,style:!0});var _=w(e);l=y(_,"DIV",{class:!0});var h=w(l);c&&c.l(h),s=S(h),o&&o.l(h),h.forEach(m),n=S(_),_.forEach(m),this.h()},h(){D(l,"class","block indicator w-full"),D(e,"class",a="rsv "+i[1]+" bg-fixed "+i[11](i[23].styleType)+" mb-1 text-sm cursor-pointer hover:font-semibold"),C(e,"height",H*(i[23].nSlots/i[6])-ue+"rem")},m(f,_){v(f,e,_),p(e,l),c&&c.m(l,null),p(l,s),o&&o.m(l,null),p(e,n),u||(d=de(e,"click",function(){Pe(i[8](i[23].data))&&i[8](i[23].data).apply(this,arguments)}),u=!0)},p(f,_){i=f,_[0]&128&&(t=["single","end"].includes(i[23].styleType)),t?c?c.p(i,_):(c=oe(i),c.c(),c.m(l,s)):c&&(c.d(1),c=null),_[0]&128&&(r=["single","start"].includes(i[23].styleType)),r?o?o.p(i,_):(o=fe(i),o.c(),o.m(l,null)):o&&(o.d(1),o=null),_[0]&130&&a!==(a="rsv "+i[1]+" bg-fixed "+i[11](i[23].styleType)+" mb-1 text-sm cursor-pointer hover:font-semibold")&&D(e,"class",a),_[0]&192&&C(e,"height",H*(i[23].nSlots/i[6])-ue+"rem")},d(f){f&&m(e),c&&c.d(),o&&o.d(),u=!1,d()}}}function oe(i){let e,l;return{c(){e=k("span"),this.h()},l(t){e=y(t,"SPAN",{class:!0}),w(e).forEach(m),this.h()},h(){D(e,"class",l="rsv-indicator "+Z(i[23].data))},m(t,s){v(t,e,s)},p(t,s){s[0]&128&&l!==(l="rsv-indicator "+Z(t[23].data))&&D(e,"class",l)},d(t){t&&m(e)}}}function fe(i){let e,l=i[10](i[23].data,i[23].nSlots,i[23].width,i[5]),t=[];for(let s=0;s<l.length;s+=1)t[s]=ae(te(i,l,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();e=N()},l(s){for(let r=0;r<t.length;r+=1)t[r].l(s);e=N()},m(s,r){for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(s,r);v(s,e,r)},p(s,r){if(r[0]&1184){l=s[10](s[23].data,s[23].nSlots,s[23].width,s[5]);let n;for(n=0;n<l.length;n+=1){const a=te(s,l,n);t[n]?t[n].p(a,r):(t[n]=ae(a),t[n].c(),t[n].m(e.parentNode,e))}for(;n<t.length;n+=1)t[n].d(1);t.length=l.length}},d(s){q(t,s),s&&m(e)}}}function ae(i){let e,l=i[26]+"",t;return{c(){e=k("div"),t=L(l)},l(s){e=y(s,"DIV",{});var r=w(e);t=z(r,l),r.forEach(m)},m(s,r){v(s,e,r),p(e,t)},p(s,r){r[0]&160&&l!==(l=s[26]+"")&&A(t,l)},d(s){s&&m(e)}}}function ce(i){let e;function l(r,n){return r[23].blkType==="rsv"?je:Oe}let t=l(i),s=t(i);return{c(){s.c(),e=N()},l(r){s.l(r),e=N()},m(r,n){s.m(r,n),v(r,e,n)},p(r,n){t===(t=l(r))&&s?s.p(r,n):(s.d(1),s=t(r),s&&(s.c(),s.m(e.parentNode,e)))},d(r){s.d(r),r&&m(e)}}}function he(i){let e,l,t=i[0].name+"",s,r,n=i[20]+"",a,u,d,c=i[7].schedule[i[22]]&&re(i);return{c(){e=k("div"),l=k("div"),s=L(t),r=E(),a=L(n),u=E(),c&&c.c(),d=E(),this.h()},l(o){e=y(o,"DIV",{class:!0,style:!0});var f=w(e);l=y(f,"DIV",{class:!0});var _=w(l);s=z(_,t),r=S(_),a=z(_,n),_.forEach(m),u=S(f),c&&c.l(f),d=S(f),f.forEach(m),this.h()},h(){D(l,"class","font-semibold"),D(e,"class","column text-center"),C(e,"width",88/i[0].resources.length+"%")},m(o,f){v(o,e,f),p(e,l),p(l,s),p(l,r),p(l,a),p(e,u),c&&c.m(e,null),p(e,d)},p(o,f){f[0]&1&&t!==(t=o[0].name+"")&&A(s,t),f[0]&1&&n!==(n=o[20]+"")&&A(a,n),o[7].schedule[o[22]]?c?c.p(o,f):(c=re(o),c.c(),c.m(e,d)):c&&(c.d(1),c=null),f[0]&1&&C(e,"width",88/o[0].resources.length+"%")},d(o){o&&m(e),c&&c.d()}}}function Ge(i){let e,l,t,s,r,n;Ie(i[14]);let a=i[4]&&se();function u(o,f){return f[0]&4&&(l=null),l==null&&(l=F.getOpenForBusiness(G(o[2]))===!1),l?Ae:qe}let d=u(i,[-1,-1]),c=d(i);return{c(){a&&a.c(),e=E(),c.c(),t=N()},l(o){a&&a.l(o),e=S(o),c.l(o),t=N()},m(o,f){a&&a.m(o,f),v(o,e,f),c.m(o,f),v(o,t,f),s=!0,r||(n=de(window,"resize",i[14]),r=!0)},p(o,f){o[4]?a?f[0]&16&&W(a,1):(a=se(),a.c(),W(a,1),a.m(e.parentNode,e)):a&&(Ee(),j(a,1,1,()=>{a=null}),Se()),d===(d=u(o,f))&&c?c.p(o,f):(c.d(1),c=d(o),c&&(c.c(),c.m(t.parentNode,t)))},i(o){s||(W(a),s=!0)},o(o){j(a),s=!1},d(o){a&&a.d(o),o&&m(e),c.d(o),o&&m(t),r=!1,n()}}}const H=3,ue=.25;function Je(i,e,l){let t,s,r,n,a,u;Q(i,Le,g=>l(15,a=g)),Q(i,ze,g=>l(16,u=g));let{resInfo:d}=e,{category:c}=e,{date:o}=e,{refreshTs:f=Date.now()}=e,_=[],h=!1;const{open:b}=Te("simple-modal"),_e=g=>{b(He,{rsvs:g,hasForm:!0,disableModify:u==="admin",onSubmit:()=>{J()}})},me=(g,P)=>{let M=U(F,g,P),B=X(F,g,P),I=M[0],R=B[B.length-1];return 60/((x(R)-x(I))/M.length)},ge=(g,P)=>{let M=G(g),B=U(F,M,P),I=X(F,M,P),R=[];for(let T=0;T<B.length;T++)T%s==0&&R.push(B[T]);return R.push(I[I.length-1]),R},ve=(g,P,M,B)=>{let I="";if(g[0].resType==="course")I=a[g[0].user.id].nickname+" +"+g[0].numStudents;else for(let V=0;V<g.length;V++){let O=a[g[V].user.id].nickname;I+=O,V<g.length-1&&(I+=" and ")}let R=[],T=0;for(let V=0;V<P;V++){let O=(V==0?12:11)-2*M,ke=Math.floor(M*B/O);if(T<I.length){let K=Math.min(I.length-T,ke);R.push(I.substr(T,K)),T+=K}}return R},pe=g=>g=="single"?"mx-0.5 rounded-lg":g=="start"?"ms-0.5 rounded-s-xl":g=="end"?"me-0.5 rounded-e-xl":"rounded-none",J=async()=>{l(4,h=!0);const g=await Fe(o,c==="pool"?Y.pool:Y.classroom);g.status==="success"&&l(13,_=g.reservations||[]),l(4,h=!1)};function be(){l(3,r=window.innerWidth)}return i.$$set=g=>{"resInfo"in g&&l(0,d=g.resInfo),"category"in g&&l(1,c=g.category),"date"in g&&l(2,o=g.date),"refreshTs"in g&&l(12,f=g.refreshTs)},i.$$.update=()=>{i.$$.dirty[0]&8198&&l(7,t=Be(_,o,c)),i.$$.dirty[0]&6&&l(6,s=me(G(o),c)),i.$$.dirty[0]&9&&l(5,n=parseInt(r*88/d.resources.length/100)),i.$$.dirty[0]&4100&&(o||f)&&J()},l(3,r=0),[d,c,o,r,h,n,s,t,_e,ge,ve,pe,f,_,be]}class Ze extends ye{constructor(e){super(),we(this,e,Je,Ge,De,{resInfo:0,category:1,date:2,refreshTs:12},null,[-1,-1])}}export{Ze as D};
